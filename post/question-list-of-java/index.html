<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="google-site-verification" content="9vIieCe-Qpd78QOmBl63rGtIVbhY6sYyuxX3j8XWBA4" />
    <meta name="baidu-site-verification" content="LRrmH41lz7" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="baidu-site-verification" content="HGLXRsUXC4" />

    
    <meta name="baidu-site-verification" content="code-ANZvlnN0Xr" />

    
    <meta name="description" content="java问题列表,欢迎投稿.">
    
    <meta name="keyword"  content="liangyuanpeng|CNCF大使|LanLiang|OpenYurt|Knative|Pulsar|Prometheus|Halo|ambassador|边缘计算|kubernetes|Docker|CloudNative|Golang|Rust|Istio|微服务">

    
    <link rel="shortcut icon" href="/img/aboutme/hash-kube-rs-pulsar.png">
    

    
    <meta property="og:image" content="https://liangyuanpeng.github.io/img/banner-pexels.jpg" />
    <meta name="twitter:image" content="https://liangyuanpeng.github.io/img/banner-pexels.jpg" />

    <title>[长期更新]java问题列表-liangyuanpeng 的博客 | liangyuanpeng&#39;s Blog</title>

    <link rel="canonical" href="https://liangyuanpeng.github.io/post/question-list-of-java/">

    

    
    <link rel="stylesheet" href='https://liangyuanpeng.github.io/css/bootstrap.min.css'>

    
    <link rel="stylesheet" href="https://liangyuanpeng.github.io/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://liangyuanpeng.github.io/css/syntax.css">

    
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <script src="https://liangyuanpeng.github.io/js/jquery.min.js"></script>

    
    <script src="https://liangyuanpeng.github.io/js/bootstrap.min.js"></script>

    
    <script src="https://liangyuanpeng.github.io/js/hux-blog.min.js"></script>

    
    <script defer src='/js/cf-beacon.min.js' data-cf-beacon='{"token": "f73bc0092aeb491d89984c0eb5a87ac2"}'></script>
</head>

</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://liangyuanpeng.github.io/">Hi,I`m lan</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://liangyuanpeng.github.io/">Home</a>
                    </li>
                    
                    
                     

                    
		            <li>
                        <a href="https://liangyuanpeng.github.io/search/">SEARCH <img src="https://liangyuanpeng.github.io/img/search.png" height="15" style="cursor: pointer;"></a>
		            </li>
                    

		            <li>
                        <a href="https://liangyuanpeng.github.io/about/">关于我 </a>
		            </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://liangyuanpeng.github.io/img/banner-pexels.jpg')
    }
</style>

<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        

                       
                       <a class="tag" href="/tags/java" title="java">
                        java
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                        </a>
                        
                        <br/>
                    </div>
                    <h1>[长期更新]java问题列表</h1>
                    <h2 class="subheading"></h2>
                    <span  class="meta">Posted by 梁远鹏 on 2023-05-04
                        
                        <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                            <span id="/post/question-list-of-java/" class="leancloud_visitors meta_data_item" data-flag-title="">
    <span class="post-meta-item-icon">
      <span class="octicon octicon-eye"></span> 
    </span>
    <i class="fa fa-eye"></i>
    <span class="old-visitors-count" style="display: none;"></span>
    <span class="leancloud-visitors-count"></span>
</span>






                            阅读 </span></span>|<span class="post-date">共3367字</span>，阅读约<span class="more-meta"> 7 分钟</span>
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

		
                <header>
                <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#使用-jdk17-时立刻堆栈报错提示内存不足">使用 jdk17 时立刻堆栈报错提示内存不足</a></li>
    <li><a href="#基于-operator-framework-spring-boot-starter-的项目启动失败">基于 operator-framework-spring-boot-starter 的项目启动失败</a></li>
    <li><a href="#基于-operator-framework-spring-boot-starter-的项目graalvm-打包的二进制文件启动失败">基于 operator-framework-spring-boot-starter 的项目,Graalvm 打包的二进制文件启动失败</a></li>
    <li><a href="#gradle-打包-shade-包">gradle 打包 shade 包</a></li>
    <li><a href="#socketio客户端-使用客户端证书">socketio客户端 使用客户端证书</a></li>
    <li><a href="#maven-deploy-时报错-repository-element-was-not-specified-in-the-pom-inside-distributionmanagement-eleme">maven deploy 时报错-repository element was not specified in the POM inside distributionManagement eleme</a></li>
    <li><a href="#一次-git-commit-id-plugin-maven-插件的升级">一次 git-commit-id-plugin maven 插件的升级</a></li>
    <li><a href="#renovate-没有升级依赖到最新版本">renovate 没有升级依赖到最新版本</a></li>
    <li><a href="#jib-构建多架构的容器镜像">Jib 构建多架构的容器镜像</a></li>
    <li><a href="#jacoco-被跳过了-info-skipping-jacoco-execution-due-to-missing-execution-data-file">jacoco 被跳过了 [INFO] Skipping JaCoCo execution due to missing execution data file.</a></li>
    <li><a href="#non-static-inner-classes-like-this-can-only-by-instantiated-using-default-no-argument-constructor">non-static inner classes like this can only by instantiated using default, no-argument constructor</a></li>
  </ul>
</nav>
		

		<h1 id="说明">说明</h1>
<p>本文主要收集 java 遇到的一些常见问题,欢迎对本文进行投稿你认为好的场景或问题.</p>
<h1 id="问题来了">问题来了</h1>
<h2 id="使用-jdk17-时立刻堆栈报错提示内存不足">使用 jdk17 时立刻堆栈报错提示内存不足</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">VM Arguments:
jvm_args: -Xmx1G -XX:+UnlockExperimentalVMOptions -XX:ErrorFile<span style="color:#f92672">=</span>/usr/local/lan/logs/parser/hs_err.log -XX:HeapDumpPath<span style="color:#f92672">=</span>/usr/local/lan/dumps/parser 
java_command: com.lan.parser.YdcApplication
java_class_path <span style="color:#f92672">(</span>initial<span style="color:#f92672">)</span>: /usr/local/tomcat/webapps/ROOT/resources:/usr/local/tomcat/webapps/ROOT/classes:/usr/local/tomcat/webapps/ROOT/libs/aircompressor-0.20.jar:/usr/local/tomcat/webapps/ROOT/libs/pagehelper-spring-boot-autoconfigure-1.2.12.jar:/usr/local/tomcat/webapps/ROOT/libs/commons-pool2-2.9.0.jar:/usr/local/tomcat/webapps/ROOT/libs/persistence-api-1.0.jar:/usr/local/tomcat/webapps/ROOT/libs/jersey-common-2.32.jar:/usr/local/tomcat/webapps/ROOT/libs/spring-oxm-5.3.13.jar:/usr/local/tomcat/webapps/ROOT/libs/feign-slf4j-10.12.jar:/usr/local/tomcat/webapps/ROOT/libs/jakarta.inject-api-2.0.1.jar:/usr/local/tomcat/webapps/ROOT/libs/json-20180130.jar:/usr/local/tomcat/webapps/ROOT/libs/jersey-client-2.32.jar:/usr/local/tomcat/webapps/ROOT/libs/opentelemetry-context-1.17.0.jar:/usr/local/tomcat/webapps/ROOT/libs/logback-classic-1.2.7.jar:/usr/local/tomcat/webapps/ROOT/libs/micrometer-registry-otlp-1.9.4.jar:/usr/local/tomcat/webapps/ROOT/libs/j2objc-annotations-1.1.jar:/usr/local/tomcat/webapps/ROOT/libs/netty-transport-native-unix-common-4.1.70.Final.jar:/usr/local/tomcat/webapps/ROOT/libs/netty-handler-proxy-4.1.70.Final.jar:/usr/local/tomcat/webapps/ROOT/libs/mysql-connector-java-5.1.42.jar:/usr/local/tomcat/webapps/ROOT/libs/druid-spring-boot-starter-1.2.11.jar:/usr/local/tomcat/webapps/ROOT/libs/commons-codec-1.15.jar:/usr/local/tomcat/webapps/ROOT/libs/slf4j-api-1.7.32.jar:/usr/local/tomcat/webapps/ROOT/libs/jcip-annotations-1.0.jar:/usr/local/tomcat/webapps/ROOT/libs/druid-1.2.11.jar:/usr/local/tomcat/webapps/ROOT/libs/commons-math3-3.6.1.jar:/usr/local/tomcat/webapps/ROOT/libs/snappy-java-1.1.8.4.jar:/usr/local/tomcat/webapps/ROOT/libs/pulsar-client-api-2.10.0.jar:/usr/local/tomcat/webapps/ROOT/libs/opentelemetry-proto-0.16.0-alpha.jar:/usr/local/tomcat/webapps/ROOT/libs/metrics-core-4.1.26.jar:/usr/local/tomcat/webapps/ROOT/libs/hivemq-mqtt-client-1.2.0.jar:/usr/local/tomcat/webapps/ROOT/libs/spring-webmvc-5.3.13.jar:/usr/local/tomcat/webapps/ROOT/lib
Launcher Type: SUN_STANDARD

<span style="color:#f92672">[</span>Global flags<span style="color:#f92672">]</span>
     intx CICompilerCount                          <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>                                         <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     uint ConcGCThreads                            <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>                                         <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    ccstr ErrorFile                                <span style="color:#f92672">=</span> /usr/local/lan/logs/parser/hs_err.log            <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>command line<span style="color:#f92672">}</span>
     uint G1ConcRefinementThreads                  <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>                                         <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     uint G1EagerReclaimRemSetThreshold            <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>                                    <span style="color:#f92672">{</span>experimental<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
   size_t G1HeapRegionSize                         <span style="color:#f92672">=</span> <span style="color:#ae81ff">1048576</span>                                   <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    uintx GCDrainStackTargetSize                   <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>                                        <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    ccstr HeapDumpPath                             <span style="color:#f92672">=</span> /usr/local/lan/dumps/parser         <span style="color:#f92672">{</span>manageable<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>command line<span style="color:#f92672">}</span>
   size_t InitialHeapSize                          <span style="color:#f92672">=</span> <span style="color:#ae81ff">130023424</span>                                 <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
   size_t MarkStackSize                            <span style="color:#f92672">=</span> <span style="color:#ae81ff">4194304</span>                                   <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
   size_t MaxHeapSize                              <span style="color:#f92672">=</span> <span style="color:#ae81ff">1073741824</span>                                <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>command line<span style="color:#f92672">}</span>
   size_t MinHeapDeltaBytes                        <span style="color:#f92672">=</span> <span style="color:#ae81ff">1048576</span>                                   <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
   size_t MinHeapSize                              <span style="color:#f92672">=</span> <span style="color:#ae81ff">8388608</span>                                   <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    uintx NonNMethodCodeHeapSize                   <span style="color:#f92672">=</span> <span style="color:#ae81ff">5826188</span>                                <span style="color:#f92672">{</span>pd product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    uintx NonProfiledCodeHeapSize                  <span style="color:#f92672">=</span> <span style="color:#ae81ff">122916026</span>                              <span style="color:#f92672">{</span>pd product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    uintx ProfiledCodeHeapSize                     <span style="color:#f92672">=</span> <span style="color:#ae81ff">122916026</span>                              <span style="color:#f92672">{</span>pd product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
    uintx ReservedCodeCacheSize                    <span style="color:#f92672">=</span> <span style="color:#ae81ff">251658240</span>                              <span style="color:#f92672">{</span>pd product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     bool SegmentedCodeCache                       <span style="color:#f92672">=</span> true                                      <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
   size_t SoftMaxHeapSize                          <span style="color:#f92672">=</span> <span style="color:#ae81ff">1073741824</span>                             <span style="color:#f92672">{</span>manageable<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     bool UnlockExperimentalVMOptions              <span style="color:#f92672">=</span> true                                 <span style="color:#f92672">{</span>experimental<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>environment<span style="color:#f92672">}</span>
     bool UseCompressedClassPointers               <span style="color:#f92672">=</span> true                           <span style="color:#f92672">{</span>product lp64_product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     bool UseCompressedOops                        <span style="color:#f92672">=</span> true                           <span style="color:#f92672">{</span>product lp64_product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     bool UseFastUnorderedTimeStamps               <span style="color:#f92672">=</span> true                                 <span style="color:#f92672">{</span>experimental<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>
     bool UseG1GC                                  <span style="color:#f92672">=</span> true                                      <span style="color:#f92672">{</span>product<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>ergonomic<span style="color:#f92672">}</span>

Logging:
Log output configuration:
 <span style="color:#75715e">#0: stdout all=warning uptime,level,tags</span>
 <span style="color:#75715e">#1: stderr all=off uptime,level,tags</span>

Environment Variables:
JAVA_HOME<span style="color:#f92672">=</span>/opt/java/openjdk
JAVA_TOOL_OPTIONS<span style="color:#f92672">=</span>-Xmx1G -XX:+UnlockExperimentalVMOptions
PATH<span style="color:#f92672">=</span>/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
LANG<span style="color:#f92672">=</span>en_US.UTF-8
LC_ALL<span style="color:#f92672">=</span>en_US.UTF-8
TZ<span style="color:#f92672">=</span>Asia/Shanghai

Signal Handlers:
   SIGSEGV: crash_handler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
    SIGBUS: crash_handler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
    SIGFPE: crash_handler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
   SIGPIPE: javaSignalHandler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
   SIGXFSZ: javaSignalHandler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
    SIGILL: crash_handler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
   SIGUSR2: SR_handler in libjvm.so, mask<span style="color:#f92672">=</span>00000000000000000000000000000000, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
    SIGHUP: SIG_DFL, mask<span style="color:#f92672">=</span>00000000000000000000000000000000, flags<span style="color:#f92672">=</span>none
    SIGINT: SIG_DFL, mask<span style="color:#f92672">=</span>00000000000000000000000000000000, flags<span style="color:#f92672">=</span>none
   SIGTERM: SIG_DFL, mask<span style="color:#f92672">=</span>00000000000000000000000000000000, flags<span style="color:#f92672">=</span>none
   SIGQUIT: javaSignalHandler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO
   SIGTRAP: crash_handler in libjvm.so, mask<span style="color:#f92672">=</span>11100100010111111101111111111110, flags<span style="color:#f92672">=</span>SA_RESTART|SA_SIGINFO


---------------  S Y S T E M  ---------------

OS:
DISTRIB_ID<span style="color:#f92672">=</span>Ubuntu
DISTRIB_RELEASE<span style="color:#f92672">=</span>22.04
DISTRIB_CODENAME<span style="color:#f92672">=</span>jammy
DISTRIB_DESCRIPTION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ubuntu 22.04.1 LTS&#34;</span>
uname: Linux 3.10.0-1160.71.1.el7.x86_64 <span style="color:#75715e">#1 SMP Tue Jun 28 15:37:28 UTC 2022 x86_64</span>
OS uptime: <span style="color:#ae81ff">32</span> days 20:11 hours
libc: glibc 2.35 NPTL 2.35 
rlimit <span style="color:#f92672">(</span>soft/hard<span style="color:#f92672">)</span>: STACK 8192k/infinity , CORE infinity/infinity , NPROC infinity/infinity , NOFILE 1048576/1048576 , AS infinity/infinity , CPU infinity/infinity , DATA infinity/infinity , FSIZE infinity/infinity , MEMLOCK 64k/64k
load average: 10.92 11.49 11.05

/proc/meminfo:
MemTotal:        <span style="color:#ae81ff">8008932</span> kB
MemFree:          <span style="color:#ae81ff">990724</span> kB
MemAvailable:    <span style="color:#ae81ff">1427868</span> kB
Buffers:           <span style="color:#ae81ff">19560</span> kB
Cached:           <span style="color:#ae81ff">813384</span> kB
SwapCached:       <span style="color:#ae81ff">113108</span> kB
Active:          <span style="color:#ae81ff">3917744</span> kB
Inactive:        <span style="color:#ae81ff">2723696</span> kB
Active<span style="color:#f92672">(</span>anon<span style="color:#f92672">)</span>:    <span style="color:#ae81ff">3674760</span> kB
Inactive<span style="color:#f92672">(</span>anon<span style="color:#f92672">)</span>:  <span style="color:#ae81ff">2198536</span> kB
Active<span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>:     <span style="color:#ae81ff">242984</span> kB
Inactive<span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>:   <span style="color:#ae81ff">525160</span> kB
Unevictable:           <span style="color:#ae81ff">4</span> kB
Mlocked:               <span style="color:#ae81ff">4</span> kB
SwapTotal:       <span style="color:#ae81ff">8388604</span> kB
SwapFree:        <span style="color:#ae81ff">4455608</span> kB
Dirty:              <span style="color:#ae81ff">4816</span> kB
Writeback:             <span style="color:#ae81ff">0</span> kB
AnonPages:       <span style="color:#ae81ff">5774248</span> kB
Mapped:           <span style="color:#ae81ff">170672</span> kB
Shmem:             <span style="color:#ae81ff">64744</span> kB
Slab:             <span style="color:#ae81ff">177808</span> kB
SReclaimable:     <span style="color:#ae81ff">129676</span> kB
SUnreclaim:        <span style="color:#ae81ff">48132</span> kB
KernelStack:       <span style="color:#ae81ff">18496</span> kB
PageTables:        <span style="color:#ae81ff">32676</span> kB
NFS_Unstable:          <span style="color:#ae81ff">0</span> kB
Bounce:                <span style="color:#ae81ff">0</span> kB
WritebackTmp:          <span style="color:#ae81ff">0</span> kB
CommitLimit:    <span style="color:#ae81ff">12393068</span> kB
Committed_AS:   <span style="color:#ae81ff">13919420</span> kB
VmallocTotal:   <span style="color:#ae81ff">34359738367</span> kB
VmallocUsed:       <span style="color:#ae81ff">23220</span> kB
VmallocChunk:   <span style="color:#ae81ff">34359683124</span> kB
Percpu:             <span style="color:#ae81ff">1064</span> kB
HardwareCorrupted:     <span style="color:#ae81ff">0</span> kB
AnonHugePages:   <span style="color:#ae81ff">1767424</span> kB
CmaTotal:              <span style="color:#ae81ff">0</span> kB
CmaFree:               <span style="color:#ae81ff">0</span> kB
HugePages_Total:       <span style="color:#ae81ff">0</span>
HugePages_Free:        <span style="color:#ae81ff">0</span>
HugePages_Rsvd:        <span style="color:#ae81ff">0</span>
HugePages_Surp:        <span style="color:#ae81ff">0</span>
Hugepagesize:       <span style="color:#ae81ff">2048</span> kB
DirectMap4k:      <span style="color:#ae81ff">106368</span> kB
DirectMap2M:     <span style="color:#ae81ff">4087808</span> kB
DirectMap1G:     <span style="color:#ae81ff">6291456</span> kB

/sys/kernel/mm/transparent_hugepage/enabled: <span style="color:#f92672">[</span>always<span style="color:#f92672">]</span> madvise never
/sys/kernel/mm/transparent_hugepage/defrag <span style="color:#f92672">(</span>defrag/compaction efforts parameter<span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>always<span style="color:#f92672">]</span> madvise never

Process Memory:
Virtual Size: 1450120K <span style="color:#f92672">(</span>peak: 1450120K<span style="color:#f92672">)</span>
Resident Set Size: 11900K <span style="color:#f92672">(</span>peak: 11900K<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>anon: 5904K, file: 5996K, shmem: 0K<span style="color:#f92672">)</span>
Swapped out: 0K
C-Heap outstanding allocations: 6701K, retained: 66K
glibc malloc tunables: <span style="color:#f92672">(</span>default<span style="color:#f92672">)</span>

/proc/sys/kernel/threads-max <span style="color:#f92672">(</span>system-wide limit on the number of threads<span style="color:#f92672">)</span>: <span style="color:#ae81ff">999999</span>
/proc/sys/vm/max_map_count <span style="color:#f92672">(</span>maximum number of memory map areas a process may have<span style="color:#f92672">)</span>: <span style="color:#ae81ff">65530</span>
/proc/sys/kernel/pid_max <span style="color:#f92672">(</span>system-wide limit on number of process identifiers<span style="color:#f92672">)</span>: <span style="color:#ae81ff">32768</span>

container <span style="color:#f92672">(</span>cgroup<span style="color:#f92672">)</span> information:
container_type: cgroupv1
cpu_cpuset_cpus: 0-1
cpu_memory_nodes: <span style="color:#ae81ff">0</span>
active_processor_count: <span style="color:#ae81ff">2</span>
cpu_quota: no quota
cpu_period: <span style="color:#ae81ff">100000</span>
cpu_shares: no shares
memory_limit_in_bytes: unlimited
memory_and_swap_limit_in_bytes: unlimited
memory_soft_limit_in_bytes: unlimited
memory_usage_in_bytes: <span style="color:#ae81ff">6124</span> k
memory_max_usage_in_bytes: <span style="color:#ae81ff">6124</span> k
maximum number of tasks: unlimited
current number of tasks: <span style="color:#ae81ff">1</span>

KVM virtualization detected
Steal ticks since vm start: <span style="color:#ae81ff">0</span>
Steal ticks percentage since vm start:  0.000

CPU: total <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>initial active 2<span style="color:#f92672">)</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> cores per cpu, <span style="color:#ae81ff">2</span> threads per core<span style="color:#f92672">)</span> family <span style="color:#ae81ff">6</span> model <span style="color:#ae81ff">79</span> stepping <span style="color:#ae81ff">1</span> microcode 0x1, cx8, cmov, fxsr, ht, mmx, 3dnowpref, sse, sse2, sse3, ssse3, sse4.1, sse4.2, popcnt, lzcnt, tsc, tscinvbit, avx, avx2, aes, erms, clmul, bmi1, bmi2, rtm, adx, fma, vzeroupper, clflush, hv
CPU Model and flags from /proc/cpuinfo:
model name	: Intel<span style="color:#f92672">(</span>R<span style="color:#f92672">)</span> Xeon<span style="color:#f92672">(</span>R<span style="color:#f92672">)</span> CPU E5-2682 v4 @ 2.50GHz
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ibrs ibpb stibp fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx smap xsaveopt arat spec_ctrl intel_stibp

Online cpus: 0-1
Offline cpus: 
BIOS frequency limitation: &lt;Not Available&gt;
Frequency switch latency <span style="color:#f92672">(</span>ns<span style="color:#f92672">)</span>: &lt;Not Available&gt;
Available cpu frequencies: &lt;Not Available&gt;
Current governor: &lt;Not Available&gt;
Core performance/turbo boost: &lt;Not Available&gt;

Memory: 4k page, physical 8008932k<span style="color:#f92672">(</span>990600k free<span style="color:#f92672">)</span>, swap 8388604k<span style="color:#f92672">(</span>4455608k free<span style="color:#f92672">)</span>
Page Sizes: 4k

vm_info: OpenJDK 64-Bit Server VM <span style="color:#f92672">(</span>17.0.5+8<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> linux-amd64 JRE <span style="color:#f92672">(</span>17.0.5+8<span style="color:#f92672">)</span>, built on Oct <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">2022</span> 00:00:00 by <span style="color:#e6db74">&#34;temurin&#34;</span> with gcc 10.3.0

END.
</code></pre></div><p>一个应用程序,同时打包了 jdk11 和 jdk17 的版本,使用 jdk17 时容器无法正常启动,总是提示内存不够.</p>
<p>一开始也向这个方向排查了一遍,发现不存在内存问题,但跑 jdk17 版本的容器时总是会失败.</p>
<p>百思不得其解,最终在 stackoverflow 找到了解决的办法.</p>
<ul>
<li><a href="https://stackoverflow.com/questions/74443957/insufficient-memory-while-running-eclipse-temurin17-jdk-docker-image">https://stackoverflow.com/questions/74443957/insufficient-memory-while-running-eclipse-temurin17-jdk-docker-image</a></li>
<li><a href="https://stackoverflow.com/questions/72841549/container-fails-to-start-insufficient-memory-for-the-java-runtime-environment-t/73970043#73970043">https://stackoverflow.com/questions/72841549/container-fails-to-start-insufficient-memory-for-the-java-runtime-environment-t/73970043#73970043</a></li>
</ul>
<p>为容器设置 <code>--security-opt seccomp=unconfined</code> 覆盖默认的设置就可以正常启动了.</p>
<p>根本原因还没有研究.</p>
<h2 id="基于-operator-framework-spring-boot-starter-的项目启动失败">基于 operator-framework-spring-boot-starter 的项目启动失败</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">2023-09-07T14:05:09.037+08:00  INFO <span style="color:#ae81ff">235286</span> --- <span style="color:#f92672">[</span>omcatreconciler<span style="color:#f92672">]</span> i.j.operator.processing.Controller       : Starting <span style="color:#e6db74">&#39;mytomcatreconciler&#39;</span> controller <span style="color:#66d9ef">for</span> reconciler: cn.lank8s.demo.operator.reconciler.MyTomcatReconciler, resource: cn.lank8s.demo.operator.apis.MyTomcat
2023-09-07T14:05:10.515+08:00 ERROR <span style="color:#ae81ff">235286</span> --- <span style="color:#f92672">[</span>           main<span style="color:#f92672">]</span> i.j.o.s.starter.OperatorStarter          : Could not start operator

io.javaoperatorsdk.operator.OperatorException: Error starting operator
	at io.javaoperatorsdk.operator.Operator.start<span style="color:#f92672">(</span>Operator.java:166<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.springboot.starter.OperatorStarter.start<span style="color:#f92672">(</span>OperatorStarter.java:28<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-spring-boot-starter-5.2.0.jar:na<span style="color:#f92672">]</span>
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0<span style="color:#f92672">(</span>Native Method<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke<span style="color:#f92672">(</span>NativeMethodAccessorImpl.java:77<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke<span style="color:#f92672">(</span>DelegatingMethodAccessorImpl.java:43<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/java.lang.reflect.Method.invoke<span style="color:#f92672">(</span>Method.java:568<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at org.springframework.context.event.ApplicationListenerMethodAdapter.doInvoke<span style="color:#f92672">(</span>ApplicationListenerMethodAdapter.java:343<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.event.ApplicationListenerMethodAdapter.processEvent<span style="color:#f92672">(</span>ApplicationListenerMethodAdapter.java:228<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.event.ApplicationListenerMethodAdapter.onApplicationEvent<span style="color:#f92672">(</span>ApplicationListenerMethodAdapter.java:165<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener<span style="color:#f92672">(</span>SimpleApplicationEventMulticaster.java:172<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener<span style="color:#f92672">(</span>SimpleApplicationEventMulticaster.java:165<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent<span style="color:#f92672">(</span>SimpleApplicationEventMulticaster.java:143<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.support.AbstractApplicationContext.publishEvent<span style="color:#f92672">(</span>AbstractApplicationContext.java:437<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.context.support.AbstractApplicationContext.publishEvent<span style="color:#f92672">(</span>AbstractApplicationContext.java:370<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-context-6.0.10.jar:6.0.10<span style="color:#f92672">]</span>
	at org.springframework.boot.context.event.EventPublishingRunListener.ready<span style="color:#f92672">(</span>EventPublishingRunListener.java:109<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplicationRunListeners.lambda$ready$6<span style="color:#f92672">(</span>SpringApplicationRunListeners.java:80<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at java.base/java.lang.Iterable.forEach<span style="color:#f92672">(</span>Iterable.java:75<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplicationRunListeners.doWithListeners<span style="color:#f92672">(</span>SpringApplicationRunListeners.java:118<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplicationRunListeners.doWithListeners<span style="color:#f92672">(</span>SpringApplicationRunListeners.java:112<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplicationRunListeners.ready<span style="color:#f92672">(</span>SpringApplicationRunListeners.java:80<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:331<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:1306<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:1295<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>spring-boot-3.1.1.jar:3.1.1<span style="color:#f92672">]</span>
	at cn.lank8s.demo.operator.OperatorApplication.main<span style="color:#f92672">(</span>OperatorApplication.java:18<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>classes/:na<span style="color:#f92672">]</span>
Caused by: io.javaoperatorsdk.operator.OperatorException: io.javaoperatorsdk.operator.MissingCRDException: <span style="color:#e6db74">&#39;mytomcats.lank8s.cn&#39;</span> v1 CRD was not found on the cluster, controller <span style="color:#e6db74">&#39;mytomcatreconciler&#39;</span> cannot be registered
	at io.javaoperatorsdk.operator.api.config.ExecutorServiceManager.lambda$executeAndWaitForAllToComplete$2<span style="color:#f92672">(</span>ExecutorServiceManager.java:81<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at java.base/java.util.ArrayList.forEach<span style="color:#f92672">(</span>ArrayList.java:1511<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.api.config.ExecutorServiceManager.executeAndWaitForAllToComplete<span style="color:#f92672">(</span>ExecutorServiceManager.java:76<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.api.config.ExecutorServiceManager.boundedExecuteAndWaitForAllToComplete<span style="color:#f92672">(</span>ExecutorServiceManager.java:56<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.ControllerManager.start<span style="color:#f92672">(</span>ControllerManager.java:42<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.Operator.start<span style="color:#f92672">(</span>Operator.java:161<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	... <span style="color:#ae81ff">23</span> common frames omitted
Caused by: io.javaoperatorsdk.operator.MissingCRDException: <span style="color:#e6db74">&#39;mytomcats.lank8s.cn&#39;</span> v1 CRD was not found on the cluster, controller <span style="color:#e6db74">&#39;mytomcatreconciler&#39;</span> cannot be registered
	at io.javaoperatorsdk.operator.processing.Controller.throwMissingCRDException<span style="color:#f92672">(</span>Controller.java:388<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.processing.Controller.start<span style="color:#f92672">(</span>Controller.java:349<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.ControllerManager.lambda$start$0<span style="color:#f92672">(</span>ControllerManager.java:43<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at io.javaoperatorsdk.operator.api.config.ExecutorServiceManager.lambda$executeAndWaitForAllToComplete$0<span style="color:#f92672">(</span>ExecutorServiceManager.java:70<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator-framework-core-4.4.0.jar:na<span style="color:#f92672">]</span>
	at java.base/java.util.concurrent.FutureTask.run<span style="color:#f92672">(</span>FutureTask.java:264<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker<span style="color:#f92672">(</span>ThreadPoolExecutor.java:1136<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run<span style="color:#f92672">(</span>ThreadPoolExecutor.java:635<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
	at java.base/java.lang.Thread.run<span style="color:#f92672">(</span>Thread.java:833<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
</code></pre></div><p>原因是项目启动依赖于项目对应的 CRD,需要先将 CRD 资源 create 到 kubernetes 当中.</p>
<p>可以执行 <code>mvn compile</code> 来生成 CRD 的 yaml.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">lan@lan:~/repo/git/kubernetes-with-java/operator$ ls target/classes/META-INF/fabric8/
mytomcats.lank8s.cn-v1beta1.yml  mytomcats.lank8s.cn-v1.yml
lan@lan:~/repo/git/kubernetes-with-java/operator$ k create -f target/classes/META-INF/fabric8/mytomcats.lank8s.cn-v1.yml 
customresourcedefinition.apiextensions.k8s.io/mytomcats.lank8s.cn created
</code></pre></div><h2 id="基于-operator-framework-spring-boot-starter-的项目graalvm-打包的二进制文件启动失败">基于 operator-framework-spring-boot-starter 的项目,Graalvm 打包的二进制文件启动失败</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">lan@lan:~/work/lanactions/lanactions/kubernetes-with-java/operator$ target/operator 

  .   ____          _            __ _ _
 /<span style="color:#ae81ff">\\</span> / ___<span style="color:#e6db74">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
</span><span style="color:#e6db74">( ( )\___ | &#39;</span>_ | <span style="color:#e6db74">&#39;_| | &#39;</span>_ <span style="color:#ae81ff">\/</span> _<span style="color:#e6db74">`</span> | <span style="color:#ae81ff">\ \ \ \
</span><span style="color:#ae81ff"></span> <span style="color:#ae81ff">\\</span>/  ___<span style="color:#f92672">)</span>| |_<span style="color:#f92672">)</span>| | | | | <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>_| |  <span style="color:#f92672">)</span> <span style="color:#f92672">)</span> <span style="color:#f92672">)</span> <span style="color:#f92672">)</span>
  <span style="color:#e6db74">&#39;  |____| .__|_| |_|_| |_\__, | / / / /
</span><span style="color:#e6db74"> =========|_|==============|___/=/_/_/_/
</span><span style="color:#e6db74"> :: Spring Boot ::                (v3.1.1)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">2023-09-07T06:35:19.486Z  INFO 11782 --- [           main] c.l.demo.operator.OperatorApplication    : Starting AOT-processed OperatorApplication using Java 17.0.7 with PID 11782 (/home/lan/work/lanactions/lanactions/kubernetes-with-java/operator/target/operator started by runner in /home/lan/work/lanactions/lanactions/kubernetes-with-java/operator)
</span><span style="color:#e6db74">2023-09-07T06:35:19.486Z  INFO 11782 --- [           main] c.l.demo.operator.OperatorApplication    : No active profile set, falling back to 1 default profile: &#34;default&#34;
</span><span style="color:#e6db74">2023-09-07T06:35:19.506Z  INFO 11782 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
</span><span style="color:#e6db74">2023-09-07T06:35:19.506Z  INFO 11782 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
</span><span style="color:#e6db74">2023-09-07T06:35:19.506Z  INFO 11782 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.10]
</span><span style="color:#e6db74">2023-09-07T06:35:19.513Z  INFO 11782 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
</span><span style="color:#e6db74">2023-09-07T06:35:19.513Z  INFO 11782 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 27 ms
</span><span style="color:#e6db74">2023-09-07T06:35:19.519Z  WARN 11782 --- [           main] w.s.c.ServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;</span>myTomcatReconciler<span style="color:#e6db74">&#39;: Instantiation of supplied bean failed
</span><span style="color:#e6db74">2023-09-07T06:35:19.519Z  INFO 11782 --- [           main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
</span><span style="color:#e6db74">2023-09-07T06:35:19.520Z ERROR 11782 --- [           main] o.s.boot.SpringApplication               : Application run failed
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;</span>myTomcatReconciler<span style="color:#960050;background-color:#1e0010">&#39;</span>: Instantiation of supplied bean failed
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.obtainFromSupplier<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:1220<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:1158<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:560<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:520<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0<span style="color:#f92672">(</span>AbstractBeanFactory.java:326<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton<span style="color:#f92672">(</span>DefaultSingletonBeanRegistry.java:234<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean<span style="color:#f92672">(</span>AbstractBeanFactory.java:324<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean<span style="color:#f92672">(</span>AbstractBeanFactory.java:200<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons<span style="color:#f92672">(</span>DefaultListableBeanFactory.java:973<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization<span style="color:#f92672">(</span>AbstractApplicationContext.java:941<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.context.support.AbstractApplicationContext.refresh<span style="color:#f92672">(</span>AbstractApplicationContext.java:608<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh<span style="color:#f92672">(</span>ServletWebServerApplicationContext.java:146<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at org.springframework.boot.SpringApplication.refresh<span style="color:#f92672">(</span>SpringApplication.java:734<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at org.springframework.boot.SpringApplication.refreshContext<span style="color:#f92672">(</span>SpringApplication.java:436<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:312<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:1306<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at org.springframework.boot.SpringApplication.run<span style="color:#f92672">(</span>SpringApplication.java:1295<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:3.1.1<span style="color:#f92672">]</span>
        at cn.lank8s.demo.operator.OperatorApplication.main<span style="color:#f92672">(</span>OperatorApplication.java:18<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
Caused by: java.lang.ExceptionInInitializerError: null
        at org.snakeyaml.engine.v2.api.Load.loadAllFromInputStream<span style="color:#f92672">(</span>Load.java:166<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.utils.KubernetesSerialization.parseYaml<span style="color:#f92672">(</span>KubernetesSerialization.java:270<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal<span style="color:#f92672">(</span>KubernetesSerialization.java:252<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal<span style="color:#f92672">(</span>KubernetesSerialization.java:342<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal<span style="color:#f92672">(</span>KubernetesSerialization.java:327<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.utils.Serialization.unmarshal<span style="color:#f92672">(</span>Serialization.java:185<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.internal.KubeConfigUtils.parseConfigFromString<span style="color:#f92672">(</span>KubeConfigUtils.java:47<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.Config.loadFromKubeconfig<span style="color:#f92672">(</span>Config.java:704<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.Config.tryKubeConfig<span style="color:#f92672">(</span>Config.java:668<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.Config.autoConfigure<span style="color:#f92672">(</span>Config.java:286<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.Config.&lt;init&gt;<span style="color:#f92672">(</span>Config.java:251<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.Config.&lt;init&gt;<span style="color:#f92672">(</span>Config.java:242<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.ConfigBuilder.&lt;init&gt;<span style="color:#f92672">(</span>ConfigBuilder.java:10<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.ConfigBuilder.&lt;init&gt;<span style="color:#f92672">(</span>ConfigBuilder.java:7<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at io.fabric8.kubernetes.client.DefaultKubernetesClient.&lt;init&gt;<span style="color:#f92672">(</span>DefaultKubernetesClient.java:37<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
        at cn.lank8s.demo.operator.reconciler.MyTomcatReconciler.&lt;init&gt;<span style="color:#f92672">(</span>MyTomcatReconciler.java:34<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.obtainInstanceFromSupplier<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:1254<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.obtainInstanceFromSupplier<span style="color:#f92672">(</span>DefaultListableBeanFactory.java:949<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.obtainFromSupplier<span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory.java:1214<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:6.0.10<span style="color:#f92672">]</span>
        ... <span style="color:#ae81ff">17</span> common frames omitted
Caused by: java.nio.charset.UnsupportedCharsetException: UTF-32BE
        at java.base@17.0.7/java.nio.charset.Charset.forName<span style="color:#f92672">(</span>Charset.java:528<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>operator:na<span style="color:#f92672">]</span>
        at org.snakeyaml.engine.v2.api.YamlUnicodeReader.&lt;clinit&gt;<span style="color:#f92672">(</span>YamlUnicodeReader.java:50<span style="color:#f92672">)</span> ~<span style="color:#f92672">[</span>na:na<span style="color:#f92672">]</span>
        ... <span style="color:#ae81ff">36</span> common frames omitted
</code></pre></div><p>看起来似乎是丢失了需要的 yaml 配置文件.</p>
<h2 id="gradle-打包-shade-包">gradle 打包 shade 包</h2>
<p>两个第三方包都依赖了同一个第三方包,但版本不一样导致冲突.</p>
<h2 id="socketio客户端-使用客户端证书">socketio客户端 使用客户端证书</h2>
<p>本来计划是希望给每一个客户分发一个客户端证书,将证书作为权限管理的一部分,不过测试过后发现似乎不支持,因为在建立链接之前会发送一个 http 请求? (具体测试的时间有点久了,不太确认.)</p>
<h2 id="maven-deploy-时报错-repository-element-was-not-specified-in-the-pom-inside-distributionmanagement-eleme">maven deploy 时报错-repository element was not specified in the POM inside distributionManagement eleme</h2>
<p>原因是因为我项目中的一个子模块没有引用父模块.</p>
<p>解决方案: 在这个模块的 pom.xml 里面单独配置仓库信息:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;distributionManagement&gt;</span>
        <span style="color:#f92672">&lt;repository&gt;</span>
                <span style="color:#f92672">&lt;id&gt;</span>alisnapshot<span style="color:#f92672">&lt;/id&gt;</span>
                <span style="color:#f92672">&lt;name&gt;</span>alisnapshot<span style="color:#f92672">&lt;/name&gt;</span>
                <span style="color:#f92672">&lt;url&gt;</span>https://packages.aliyun.com/maven/repository/2127020-snapshot-G5gKXW<span style="color:#f92672">&lt;/url&gt;</span>
        <span style="color:#f92672">&lt;/repository&gt;</span>
<span style="color:#f92672">&lt;/distributionManagement&gt;</span>
</code></pre></div><h2 id="一次-git-commit-id-plugin-maven-插件的升级">一次 git-commit-id-plugin maven 插件的升级</h2>
<p>当前项目使用的是 2.1.5 版本的 git-commit-id-plugin,这应该是在 2020 年左右引进来的,是同事在网上复制的.</p>
<p>在中央仓库看了一下这个依赖包,没想到这个是 2013 年的版本了,着实有点老了.最新的版本是 2021 年的 4.9.10,看起来已经不更新了,但在搜索 git-commit-id-plugin 的时候还看到了另一个包,依赖包的 group 是 io.github.git-commit-id,因此可以很轻松的在 github 上找到这个项目: <a href="https://github.com/git-commit-id/git-commit-id-maven-plugin">git-commit-id-maven-plugin</a>,这个应该是项目的继承者了,当前最新的包是 2024 年发布的 9.0.0,因此果断升级到这个依赖的这个版本.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>pl.project13.maven<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>git-commit-id-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.1.5<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/plugin&gt;</span>
</code></pre></div><p>升级后:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>io.github.git-commit-id<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>git-commit-id-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>9.0.0<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/plugin&gt;</span>
</code></pre></div><h2 id="renovate-没有升级依赖到最新版本">renovate 没有升级依赖到最新版本</h2>
<p>项目使用 renovate 来对依赖进行自动化升级,不过配置上没有进行过太多的折腾,使用的是默认配置. 我发现依赖包是有新版本的,但是 renovate 却没有提 PR 进行升级,目前还没找到原因.</p>
<h2 id="jib-构建多架构的容器镜像">Jib 构建多架构的容器镜像</h2>
<p>Jib 有 maven 插件和 gradle 插件,可以很方便的在无docker环境下为应用构建容器镜像,但是如何构建一个多架构容器镜像呢?</p>
<h2 id="jacoco-被跳过了-info-skipping-jacoco-execution-due-to-missing-execution-data-file">jacoco 被跳过了 [INFO] Skipping JaCoCo execution due to missing execution data file.</h2>
<p>使用 jacoco 的 maven 插件单元测试检查测试覆盖率,发现 jacoco 在 mvn clean test 执行过程中被跳过了.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">...
--- jacoco-maven-plugin:0.8.12:report <span style="color:#f92672">(</span>default-report<span style="color:#f92672">)</span> @
<span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Skipping JaCoCo execution due to missing execution data file.
...
</code></pre></div><p>配置是直接从其他人博文中复制的,查看了一下官方文档,https://www.jacoco.org/jacoco/trunk/doc/prepare-agent-mojo.html</p>
<p>发现有一个显示<code>maven-surefire-plugin</code>插件的配置:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">  <span style="color:#f92672">&lt;plugin&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>maven-surefire-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;configuration&gt;</span>
      <span style="color:#f92672">&lt;argLine&gt;</span>@{argLine} -your -extra -arguments<span style="color:#f92672">&lt;/argLine&gt;</span>
    <span style="color:#f92672">&lt;/configuration&gt;</span>
  <span style="color:#f92672">&lt;/plugin&gt;</span>
</code></pre></div><p>有一个值得注意的点是我的<code>maven-surefire-plugin</code>确实配置了<code>argLine</code>,但是没有<code>@{argLine}</code>,于是我在我的配置中加上了<code>@{argLine}</code>重新跑了下 <code>mvn clean test</code>后就可以生成 jacoco 报告了.</p>
<p>在此之前我还谷歌了一些其他网友的解决方案,但原因都不太一样,不适用,因此上述内容可能也不是你 jacoco 报告失效的唯一原因.</p>
<h2 id="non-static-inner-classes-like-this-can-only-by-instantiated-using-default-no-argument-constructor">non-static inner classes like this can only by instantiated using default, no-argument constructor</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Data</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JibContainerObj</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> String image<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String imageId<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String imageDigest<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> imagePushed<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> tags <span style="color:#f92672">=</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">JibContainerObj</span><span style="color:#f92672">(){</span>

        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testStart</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
        ObjectMapper objectMapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
        InputStream inputStream <span style="color:#f92672">=</span> getClass<span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/jib-image.json&#34;</span><span style="color:#f92672">);</span>
        Assertions<span style="color:#f92672">.</span><span style="color:#a6e22e">assertNotNull</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        JibContainerObj jibContainerObj <span style="color:#f92672">=</span> objectMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> TypeReference<span style="color:#f92672">&lt;</span>JibContainerObj<span style="color:#f92672">&gt;(){});</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>引起这个问题是上述代码中读取 jib-image.json 文件 然后使用 jackson 去反序列化为对象的时候发生的,根据提示,内部类需要为静态类,因此在内部类上添加静态修饰就可以了.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">--- class JibContainerObj implements Serializable {
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ static class JibContainerObj implements Serializable {
</span></code></pre></div><h1 id="fastjson迁移到jackson">fastjson迁移到jackson</h1>
<p>项目需要代码大量使用了 fastjson,现在需要彻底拜托 fastjson (漏洞烦恼),迁移到 jackson.</p>
<p>所幸有较多时间处理,没有赶工上线的焦虑.</p>
<p>原先基于 fastjson 封装了一个工具类叫 JSONUtil,第一步就是先将工具类改名为 FastjsonUtil,避免由于惯性的问题继续让该类被同事使用.(在声明抛弃fastjson并且改名之前已经新增了不少代码仍然使用这个类&hellip;)</p>
<p>基于 jackson 封装一个 JacksonUtil 的,新的代码都将使用这个工具类来操作 json 相关内容.</p>
<p>最后一步则是逐步将使用 FastjsonUtil 的代码迁移到 JacksonUtil,同时检查下测试是否足够覆盖,如果没有的话就补充一下测试内容.</p>
<p>在整个过程中分多个版本上线,将压力分摊到多次上线中,整体来说没有什么大问题,最重要的一个因素是<em>时间多</em>.</p>
<h1 id="socketio-序列化错误">socketio 序列化错误</h1>
<p>Cannot construct instance of <code>com.*</code> (although at least one Creator exists): cannot deserialize</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">socketIOClient<span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span>LAN_K8S_EVENT<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> JSONObject<span style="color:#f92672">(</span>JacksonJsonUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">beanToJson</span><span style="color:#f92672">(</span>dto<span style="color:#f92672">)));</span>
</code></pre></div><p>使用 jackson 序列化或直接传递对象到socketio server 的时候报错了,提示无法反序列化为对象,缺少构造函数,然而实际情况是构造函数是有的.</p>
<p>最后解决方案是使用 org.json.JSONObject 来将对象再包一层,传递 JSONObject 对象给服务器就没问题了.</p>
<p>根本问题是传递到 socketio server 时, json 数据中的双引号<code>&quot;</code>被转义变成了<code>\&quot;</code>, 不确定是否有更优雅的方法解决.</p>
<p>项目 issue 也有其他人遇到这个问题: <a href="https://github.com/mrniko/netty-socketio/issues/258">EventListener Can not parse JSON string to Java Object</a></p>


        <h2>微信公众号</h2>
<p>扫描下面的二维码关注我们的微信公众号,第一时间查看最新内容。同时也可以关注我的Github,看看我都在了解什么技术,在页面底部可以找到我的Github。</p>
<img  src="/img/qrcode_for_sikekafeidou.jpg" alt="wechat-qrcode">

        <div style="padding: 10px 0; margin: 20px auto; width: 100%; font-size:16px; text-align: center;">
    <button class="btn btn-danger"  id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
        <span>「来都来了」赞赏</span></button>
    <div  id="QR" style="display: none;">
        <div id="wechat" style="display: inline-block">
            <p>如果本文对你有帮助的话欢迎通过微信或支付宝对我进行赞助,强烈建议你在支付的备注上填上你的 githubID 或你的昵称,让我知道我该感谢谁!!! </br></br>
                赞助金额设置为固定金额:8元. </br> 
                8元赠与我,发发发反馈给你,2023祝你收入翻番一路发到底:)</p>
            <a class="fancybox" rel="group">
                <img id="wechat_qr" src="/img/wechat-zhifubao.png" alt="Pay"></a>
        </div>
    </div>
</div>

        

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/question-list-of-kubernetes/" data-toggle="tooltip" data-placement="top" title="[长期更新]kubernetes问题列表记录">&larr; [长期更新]kubernetes问题列表记录</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/helpful-github-action/" data-toggle="tooltip" data-placement="top" title="githubaction常用记录">githubaction常用记录 &rarr;</a>
                    </li>
                    
                </ul>

            


<script src="https://giscus.app/client.js"
        data-repo="liangyuanpeng/liangyuanpeng.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNDkwMDQ2OTM="
        data-category=""
        data-category-id="DIC_kwDOCOGhlc4CVwo2"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>




            </div>

            

            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                
                扫码下面二维码加我微信 :)
                <img src="https://liangyuanpeng.github.io/img/aboutme/wechat-lan.png" />
                
            </div> 

            

            
            
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
<br/>
<h5>开源项目推荐</h5>

<style type="text/css">
.pinned-repos {
  max-width: 300px;
  margin: 0 auto;
}

.repo-card {
  display: flex;
  flex-direction: column;
  padding: 16px;
  border: 1px solid #e1e4e8;
  border-radius: 6px;
  background-color: #fff;
}

.repo-card:hover {
  box-shadow: 0 1px 3px rgba(36,41,46,.08);
}

.repo-card h2 {
  margin-top: 0;
  font-size: 20px;
  font-weight: 200;
  color: #0366d6;
}

.repo-card p {
  margin: 8px 0 16px;
  font-size: 14px;
  color: #586069;
}

.repo-card-stats {
  display: flex;
  flex-wrap: wrap;
  align-items: center;  
}

.repo-card-stats span {
  font-size: 12px;
  color: #586069;
  margin-right: 16px;
}

.repo-card-stats strong {
  font-weight: 200;
  color: #24292e;
}
</style>

    
    <ul class="margin-bottom: 25px;pinned-repo-list">
      <li>
        <div class="repo-card">
          <div class="repo-card-details">
            <h2><a href="https://github.com/liangyuanpeng/replacer">replacer</a></h2>
            <p>K8S webhook的参考实现|Replace container image of kubernetes mutate webhook.</p>
            <div class="repo-card-stats">
              <span>Language: <strong>Golang</strong></span>
              <span>Forks: <strong>*</strong></span>
              <span>Stars: <strong>*</strong></span>
              <span>Updated: <strong>Nov 20, 2021</strong></span>
            </div>
          </div>
        </div>
      </li>
    </ul>

            </div>

            
            
            <div class="
            col-lg- col-lg-offset-2
            col-md-10 col-md-offset-1
            ">
            <section>
                <hr class="hidden-sm hidden-xs">
                

<h2>相关文章</h2>
<ul style="margin-bottom: 25px;">
    
    <li><a href="/post/jib-springboot-docker-maven/">不用安装docker也能构建docker镜像</a></li>
    
    <li><a href="/post/deploy-apache-rocketmq/">Apache RocketMQ单机部署</a></li>
    
</ul>

            </section>
            </div>
            

            


        </div>
    </div>
</article>






<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="Hi,I`m lan" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a target="_blank" href="https://github.com/liangyuanpeng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                   
                   
                    
                    <li>
                        <a target="_blank" href="https://liangyuanpeng.github.io/img/aboutme/wechat-lan.png">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:liangyuanpengem@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    <li>
                        <a href="https://twitter.com/lan31793328">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/liangyuanpeng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://weibo.com/u/1908782280">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    

		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Hi,I`m lan , 2023
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>



<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>




<script type="text/javascript">

    
    

    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>




<script>
    async("/js/fastclick-1.0.6.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>




<script>
    
    var _baId = 'fad9c137f8ce239f9b323d36c871f8e6';

    
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>







<script async src="https://www.googletagmanager.com/gtag/js?id=G-RTTRHGYFWL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RTTRHGYFWL');
</script>



</body>
</html>
