---
layout:     post 
slug:   "how-to-config-for-cache-from-gateway"
title:      "常用网关都是如何配置缓存请求的"
subtitle:   ""
description: ""
date:       2023-02-20
author:     "梁远鹏"
image: "https://res.cloudinary.com/lyp/image/upload/v1544363191/hugo/blog.github.io/743a4e9227e1f14cb24a1eb6db29e183.jpg"
published: true
tags:
    - pipy
    - nginx
    - envoy
    - apisix
    - kong
categories: 
    - TECH
---

# 前言 

# Envoy
# apisix
# Pipy
docker pull flomesh/pipy:0.90.0-54

## pipy的体验

上手门槛比较高，官方文档相对也是比较少的，有一种束手无策的感觉.

例如,官方例子中是的 js 脚本是这样的:  

```shell
pipy()

  .listen(8000)
  .demuxHTTP().to(
    $=>$.muxHTTP().to(
      $=>$.connect('localhost:8080')
    )
  )

```

这是将请求转发到 localhost:8080,而我将地址做了一个修改,将请求修改为转发到`https://registry.lank8s.cn`

```shell
pipy()
  .listen(8000)
  .demuxHTTP().to(
    $=>$.muxHTTP().to(
      $=>$.connect('https://registry.lank8s.cn')
    )
  )
```

PS: `registry.worker.liangyuanpeng.com:443`和`https://registry.lank8s.cn`都试过,一样的结果.

然后请求`http://192.168.56.11:8000/v2/kube-apiserver/manifests/v1.26.0`尝试反向代理的效果,很遗憾,失败了并且没有任何解决问题的思路.

错误信息:
```shell
2023-02-20 14:07:29.965 [ERR] [connect] invalid target: https://registry.worker.liangyuanpeng.com/v2/
2023-02-20 14:07:29.965 [ERR] [connect] invalid target: https://registry.worker.liangyuanpeng.com/v2/
2023-02-20 14:07:29.965 [ERR] [connect] invalid target: https://registry.worker.liangyuanpeng.com/v2/
2023-02-20 14:08:29.968 [ERR] [connect] invalid target: https://registry.worker.liangyuanpeng.com/v2/
2023-02-20 14:08:29.968 [ERR] [connect] invalid target: https://registry.worker.liangyuanpeng.com/v2/
```

我请求的路径是`/v2/kube-apiserver/manifests/v1.26.0`,而错误提示的路径确实`/v2/`,很奇怪.

这只是我的一个请求转发 hello world,但我拿它没有任何办法 :(

浅尝后我对 flomesh pipy 的看法是:劝退程度很大…

劝退的不是 js 脚本本身的复杂度,而是文档,入门指引性 example 太少. 

而 Pipy 称自身为可编程网关,我更愿意把它叫做"完全编程网关",而把 Envoy 叫做可编程网关.

因为如果你不会写 pipy js 的话,你是没办法使用它的,对于 Envoy 来说,你只有在扩展特定功能点时才需要以编程的方式制作 filter,否则可以直接使用 Envoy 配置文件即可.

# Nginx
# Kong

# 注意 

本文还在持续创作当中.
