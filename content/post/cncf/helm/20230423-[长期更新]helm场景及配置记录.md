---
layout:     post 
slug:      "helm-config-note-long-term"
title:      "[长期更新]helm常见问题以及配置记录"
subtitle:   ""
description: "helm常见问题以及配置记录,欢迎投稿."
date:       2023-04-23
author:     "梁远鹏"
image: "/img/banner-pexels.jpg"
published: true
tags:
    - k8s
    - cncf
    - kubernetes
    - helm
categories: 
    - cloudnative
---


# 说明

本文主要收集常见场景下 helm 配置以及遇到的一些常见问题,欢迎对本文进行投稿你认为好的场景配置或问题.

## unclosed action 错误

用 helm 3.5 在 kubernetes 1.29 上安装 contour的时候报错了:

```shell
[root@lank8scn yamls]# helm upgrade -i contour bitnami/contour -n contour --set replicaCount=1
Release "contour" does not exist. Installing it now.
Error: parse error at (contour/charts/common/templates/_resources.tpl:15): unclosed action
```

在网上快速搜索了一下看到这个问题可以通过升级 helm 到 3.7.0 来解决,我是直接升级到了 3.14.0 解决了.


## cannot unmarshal bool into Go struct field EnvVar.spec.template.spec.containers.env.value of type string

使用 helm 为资源设置环境变了时报错了.

values.yaml 相关部分内容如下:
```yaml
# Additional Environment variables
env: {}
    # - name: GOMAXPROCS
    #   valueFrom:
    #     resourceFieldRef:
    #       resource: limits.cpu
```

```
helm upgrade ksm . --set service.type=NodePort --set service.nodePort=30081 --set env[0].name="KUBE_FEATURE" --set env[0].value="true" -i 
```

更新后如下所示:

```
helm upgrade ksm . --set service.type=NodePort --set service.nodePort=30081 --set "env[0].name=KUBE_FEATURE" --set "env[0].value='true'" -i 
```

将整个 --set 参数作为一个字符串传递就可以解决了.

## 官方文档

https://helm.sh/docs/
